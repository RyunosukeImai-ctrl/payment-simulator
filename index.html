<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>お支払いシミュレーション - 負債の深淵へようこそ</title> <!-- タイトルもそれっぽく変更 -->
        <meta name='robots' content='noindex, nofollow'/> <!-- 検索エンジンには絶対表示しない -->
        <meta name="description" content="お支払いシミュレーション"/>
        <!-- 外部CSSの読み込みは行いません -->

        <!-- シミュレーター専用スタイル (借金地獄デザイン) -->
        <style type="text/css">
            /* 基本リセットと全体スタイル */
            body {
                font-family: 'Courier New', Courier, monospace; /* 不安定な感じのフォント */
                line-height: 1.4;
                color: #8b0000; /* 深い赤 (血や負債の色) */
                background: repeating-linear-gradient(-45deg, #1a0000, #1a0000 10px, #330000 10px, #330000 20px); /* 血痕のようなストライプ */
                margin: 0;
                padding: 10px; /* 余白を狭く */
                display: flex;
                justify-content: center;
                align-items: flex-start;
                min-height: 100vh;
                overflow-x: hidden; /* 横スクロールを抑制 */
                cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%238B0000" d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2zm-.21 4.727l-2.828 9.999L14 10.857l2.828 9.999-4.909-4.909-4.909 4.909 2.828-9.999z"/></svg>') 12 12, auto; /* 奇妙なカーソル */
                 filter: sepia(0.3) contrast(1.2); /* セピアとコントラストで古びて不気味な質感 */
            }

            .container {
                max-width: 700px; /* 幅を元に戻す */
                margin: 0 auto;
                padding: 20px;
                background-color: rgba(0, 0, 0, 0.9); /* 真っ黒に近い背景 */
                border: 3px dashed #8b0000; /* 深い赤の点線ボーダー */
                box-shadow: 0 0 15px rgba(139, 0, 0, 0.8), inset 0 0 10px rgba(139, 0, 0, 0.5); /* 赤い影 */
                border-radius: 0;
                box-sizing: border-box;
                position: relative; /* 歪みの基準 */
                 /*transform: skewX(-2deg); /* 全体を少し歪める */
            }
             .container::before { /* ノイズや汚れのオーバーレイ */
                 content: "";
                 position: absolute;
                 top: 0; left: 0; right: 0; bottom: 0;
                 background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAWlBMVEUAAAD/AAD/mf//zP/M/wD/AP//AP8v+/8OQO0XG9oXAAAAAWJLR0QAw/FWwQAAABNJREFUCNdjYGBgYGD4z8DAwMAAAAFkAGs53XwLAAAAAElFTkSuQmCC') repeat; /* 簡易ノイズパターン */
                 opacity: 0.1;
                 pointer-events: none;
             }


            h1, h2 {
                color: #ff4500; /* 派手なオレンジ赤 */
                border-bottom: 3px solid #8b0000; /* 深い赤の下線 */
                padding-bottom: 8px;
                margin-top: 20px;
                margin-bottom: 25px;
                font-size: 2.2rem; /* サイズ調整 */
                font-weight: bold;
                text-align: left; /* 左寄せに */
                text-shadow: 1px 1px 3px #000, 0 0 5px #ff4500; /* ギラつく影 */
                transform: translateX(-5px) rotate(-0.5deg); /* 少しずらして歪める */
            }

            h2 {
                 font-size: 1.6rem;
                 border-bottom-width: 2px;
                 margin-top: 30px;
                 transform: translateX(5px) rotate(0.5deg); /* 逆方向に歪める */
            }

            p {
                margin-bottom: 15px;
                 color: #AAAAAA; /* グレー */
                 font-size: 0.95rem;
            }

            dl {
                margin-bottom: 25px;
                border: 1px solid #550000; /* 暗い赤 */
                padding: 10px;
                background-color: rgba(51, 0, 0, 0.6); /* 暗い赤の半透明背景 */
            }
            dl dt {
                font-weight: bold;
                margin-top: 8px;
                color: #ff6347; /* トマト色のような赤 */
                text-shadow: 1px 1px 1px #000;
            }
            dl dd {
                margin-bottom: 6px;
                margin-left: 20px;
                color: #CCCCCC; /* 明るめのグレー */
                font-size: 0.9rem;
            }

            /* シミュレーターフォームのスタイル (借金地獄デザイン) */
            .calc-form {
                margin-top: 30px; /* 上部に隙間 */
                margin-bottom: 30px;
                background-color: rgba(0, 0, 0, 0.7); /* 暗い背景 */
                padding: 20px;
                 border: 2px solid #ff4500; /* オレンジ赤のボーダー */
                 box-shadow: 0 0 10px rgba(255, 69, 0, 0.5); /* オレンジ赤の影 */
                 border-radius: 0;
                 transform: rotate(0.3deg); /* 少し歪める */
            }

             .calc-form fieldset {
                 margin-bottom: 20px;
                 padding: 15px;
                 border: 1px dashed #ff6347; /* トマト色の点線ボーダー */
                 border-radius: 0;
                 background-color: rgba(51, 0, 0, 0.4); /* 暗い赤の半透明背景 */
            }
             .calc-form legend {
                 font-weight: bold;
                 padding: 0 10px;
                 color: #ff4500; /* オレンジ赤 */
                 font-size: 1.1rem;
                 text-shadow: 1px 1px 2px #000;
            }

            /* フォーム項目のレイアウト */
            .form-item {
                margin-bottom: 10px;
            }

            .form-item label {
                display: inline-block;
                font-weight: bold;
                width: 180px; /* ラベル幅を固定 */
                margin-right: 10px;
                vertical-align: middle;
                 color: #ff6347; /* トマト色 */
                 text-shadow: 1px 1px 1px #000;
            }
             /* 円マークなどの単位ラベル */
             .form-item label.unit {
                 width: auto;
                 margin-right: 0;
                 margin-left: 5px;
                 font-weight: normal;
                 vertical-align: middle;
                 color: #AAAAAA; /* グレー */
             }

            .form-item input[type="number"],
            .form-item select,
            .form-item input[type="date"] {
                 display: inline-block;
                 width: 180px; /* 入力フィールドの幅を固定 */
                 padding: 5px;
                 border: 1px solid #8b0000; /* 深い赤のボーダー */
                 border-radius: 0;
                 box-sizing: border-box;
                 font-size: 1rem;
                 vertical-align: middle;
                 background-color: #000; /* 黒背景 */
                 color: #ffff00; /* 黄色っぽい文字 (警告色) */
                 box-shadow: inset 0 0 5px rgba(139, 0, 0, 0.5); /* 内側に赤い影 */
            }
             .form-item input[type="date"] {
                 width: 180px;
             }
             /* フォーカス時のスタイルを不気味に */
             .form-item input[type="number"]:focus,
             .form-item select:focus,
             .form-item input[type="date"]:focus {
                 outline: none;
                 border-color: #ff0000; /* 真っ赤なアウトライン */
                 box-shadow: inset 0 0 8px rgba(255, 0, 0, 0.8), 0 0 8px rgba(255, 0, 0, 0.8); /* 光るような影 */
             }


            /* ボタンのスタイル (病んだ感じ) */
             .button-group {
                 margin-top: 20px;
                 text-align: center;
             }

            .calc-form input[type="button"] {
                 padding: 10px 20px;
                 background-color: #8b0000; /* 深い赤 */
                 color: #fff; /* 白文字 */
                 border: 2px solid #ff4500; /* オレンジ赤のボーダー */
                 border-radius: 4px;
                 cursor: pointer;
                 font-size: 1rem;
                 font-weight: bold;
                 text-shadow: 1px 1px 1px #000;
                 transition: background-color 0.2s ease, border-color 0.2s ease;
                 margin: 0 5px;
                 box-shadow: 0 3px 8px rgba(139, 0, 0, 0.6); /* 暗い影 */
            }
             .calc-form input[type="button"]:hover {
                 background-color: #ff0000; /* 真っ赤に変化 */
                 border-color: #ff6347; /* 明るい赤に変化 */
                 box-shadow: 0 3px 10px rgba(255, 0, 0, 0.8); /* 影を強く */
             }
              .calc-form input[type="button"]:active {
                 background-color: #550000; /* さらに暗く */
                 border-color: #8b0000;
                 box-shadow: 0 1px 5px rgba(139, 0, 0, 0.9);
              }


             .calc-form ul {
                 margin-top: 20px;
                 font-size: 0.9rem;
                 color: #BBBBBB; /* 明るめのグレー */
                 padding-left: 20px;
                 border-top: 1px dashed #550000; /* 暗い赤の点線 */
                 padding-top: 15px;
             }
             .calc-form ul li {
                 margin-bottom: 5px;
                 list-style: none; /* リストマーカーをなくす */
                 position: relative;
                 padding-left: 15px; /* カスタムマーカー用 */
                 color: #ff4500; /* リスト項目自体も赤に */
             }
             .calc-form ul li::before {
                 content: "X"; /* 不吉なマーカー */
                 position: absolute;
                 left: 0;
                 color: #ff0000; /* 真っ赤なマーカー */
                 font-weight: bold;
             }

            /* シミュレーターの結果表示エリアのスタイル (絶望感) */
            .calculation-result {
                margin-top: 40px;
                padding: 20px;
                border: 3px solid #8b0000; /* 深い赤のボーダー */
                border-radius: 0;
                background-color: rgba(0, 0, 0, 0.85); /* 真っ黒に近い背景 */
                font-size: 1.1rem;
                line-height: 1.7;
                color: #ffff00; /* 黄色い文字 (警告/病み) */
                text-shadow: 1px 1px 2px #000;
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.6); /* 赤い光 */
                 /*filter: grayscale(0.3); /* やや色あせた感じ */
            }

            .calculation-result h3 {
                margin-top: 0;
                margin-bottom: 20px;
                color: #ff0000; /* 真っ赤 */
                font-size: 1.4rem;
                border-bottom: 2px solid #8b0000; /* 深い赤の下線 */
                padding-bottom: 10px;
                text-shadow: 1px 1px 2px #000;
            }

             .calculation-result p {
                margin-bottom: 12px;
                padding-bottom: 5px;
                border-bottom: 1px dashed #550000; /* 暗い赤の点線 */
                color: #ffff00; /* 黄色い文字 */
             }
             .calculation-result p:last-child {
                border-bottom: none;
                margin-bottom: 0;
                padding-bottom: 0;
             }

            .calculation-result strong {
                display: inline-block;
                min-width: 200px; /* 項目名を揃える */
                margin-right: 10px;
                color: #ff4500; /* オレンジ赤の項目名 */
                text-shadow: 1px 1px 1px #000;
                font-weight: bold;
            }

            .calculation-result .note {
                font-size: 0.95rem;
                color: #ffffff; /* 白の注意書き */
                margin-top: 15px;
                border-top: 2px dashed #ff0000; /* 真っ赤な点線 */
                padding-top: 10px;
                text-shadow: 1px 1px 1px #000;
                font-weight: bold;
             }
             .calculation-result .note:before {
                 content: "警告: "; /* 警告マーク */
                 color: #ff0000; /* 真っ赤 */
                 font-weight: bold;
             }


        </style>

        <!-- jQueryのみ残す -->
        <script type='text/javascript' src='https://www.kyoto-shinpan.co.jp/wp/wp-includes/js/jquery/jquery.min.js?ver=3.6.0'></script>

        <script type='text/javascript'>
            // frequency2per関数は元のコードから変更なし
            function frequency2per(frequency) {
                var p = new Array(1.67,2.51,3.35,4.2,5.06,5.91,6.78,7.64,8.52,9.39,10.28,11.16,12.05,12.95,13.85,14.75,15.66,16.57,17.49,18.41,19.34,20.27,21.21,22.15,23.1,24.04,25,25.96,26.92,27.89,28.86,29.84,30.82,31.8,32.79,33.79,34.79,35.79,36.8,37.81,38.83,39.85,40.87,41.9,42.94,43.98,45.02,46.07,47.12,48.17,49.23,50.3,51.37,52.44,53.52,54.6,55.68,56.77,57.87,58.96);
                //frequency は 1から60の想定
                if (frequency < 1 || frequency > p.length) {
                     console.warn(`Invalid frequency: ${frequency}. Returning 0.`);
                     return 0;
                }
                return p[frequency - 1];
            }

            // frequencycheck関数は元のコードから変更なし
            function frequencycheck(frequency) {
                var p = new Array(3,6,10,12,15,18,20,24,30,36,42,48,54,60);
                return p.includes(frequency);
            }

             // calcFDate関数は元のコードから変更なし
            function calcFDate(interviewDay) {
                const today = new Date();
                const currentMonth = today.getMonth() + 1; // 1-12

                if (interviewDay <= 14) {
                    return currentMonth;
                } else {
                    let nextMonth = currentMonth + 1;
                    if (nextMonth > 12) {
                         nextMonth = nextMonth - 12;
                    }
                    return nextMonth;
                }
            }

            // displayFirstPaymentDate関数はEMPフォーム専用に調整
            function displayFirstPaymentDate() {
                const form = document.getElementById('KS_calcEMP');
                // 結果エリア内の要素を探す
                const firstPaymentDateElement = form.querySelector('#result-emp .first-payment-date');

                // 結果エリアが表示されていない場合は日付も表示しない
                if (!firstPaymentDateElement || document.getElementById('result-emp').innerHTML.trim() === '') {
                     if(firstPaymentDateElement) firstPaymentDateElement.innerHTML = ''; // クリアしておく
                     return;
                }

                 const interviewDateInput = form.querySelector('input[name="interviewDate"]');
                 const interviewDateValue = interviewDateInput ? interviewDateInput.value : '';

                // 日付が入力されていない場合の表示
                if (!interviewDateValue) {
                    firstPaymentDateElement.innerHTML = "<strong>初回支払日:</strong> 記入面談日を選択してください。";
                    return;
                }

                const dateParts = interviewDateValue.split('-');
                if (dateParts.length !== 3) {
                    firstPaymentDateElement.innerHTML = "<strong>初回支払日:</strong> 無効な日付形式です。";
                    return;
                }

                const year = parseInt(dateParts[0], 10);
                const month = parseInt(dateParts[1], 10);
                const day = parseInt(dateParts[2], 10);

                 if (isNaN(year) || isNaN(month) || isNaN(day) || year < 1000 || month < 1 || month > 12 || day < 1 || day > 31) { // 簡易的な日付妥当性チェック
                     firstPaymentDateElement.innerHTML = "<strong>初回支払日:</strong> 無効な日付が入力されました。";
                    return;
                 }


                 let firstPaymentMonthCalc = month; // 1-12
                 let firstPaymentYearCalc = year;

                 // 記入日15日以降は翌月払いと仮定
                 if (day >= 15) {
                     firstPaymentMonthCalc += 1;
                     if (firstPaymentMonthCalc > 12) {
                         firstPaymentMonthCalc = 1;
                         firstPaymentYearCalc += 1;
                     }
                 }

                const firstPaymentDay = 27; // 支払日は固定で27日と仮定
                firstPaymentDateElement.innerHTML = `<strong>初回支払日:</strong> ${firstPaymentYearCalc}年${firstPaymentMonthCalc}月${firstPaymentDay}日`;
            }


            // calcBCount関数はEMPフォーム専用に調整
            function calcBCount(frequency, bmonth1, bmonth2, interviewDay) {
                let count = 0;
                // interviewDayは日付の数値 (1-31)
                // 面談日基準で初回支払月を決定
                const firstPaymentMonth = calcFDate(interviewDay); // 1-12

                // frequency2perのテーブルは60回まで対応しているため、frequencyの上限を60回とする
                const effectiveFrequency = Math.min(frequency, 60);

                for (let i = 0; i < effectiveFrequency; i++) {
                    let currentMonth = firstPaymentMonth + i;
                    while (currentMonth > 12) {
                        currentMonth -= 12;
                    }

                    if (currentMonth === bmonth1 || currentMonth === bmonth2) {
                        count++;
                    }
                }
                return count;
            }


            function calcEMP() {
                const form = document.getElementById('KS_calcEMP');
                const resultDiv = document.getElementById('result-emp');
                resultDiv.innerHTML = ''; // 計算前に結果表示エリアをクリア

                // input/select要素から値を取得
                const price = parseInt(form.price.value);
                const frequency = parseInt(form.frequency.value); // プルダウンから取得
                const dpay = parseInt(form.dpay.value);
                const bmonth1 = parseInt(form.bmonth1.value);
                const bmonth2 = parseInt(form.bmonth2.value);
                const baddpay = parseInt(form.baddpay.value);
                const interviewDateInput = form.querySelector('input[name="interviewDate"]');
                const interviewDateValue = interviewDateInput ? interviewDateInput.value : '';

                // バリデーション
                if (isNaN(price) || isNaN(frequency) || isNaN(dpay) || isNaN(bmonth1) || isNaN(bmonth2) || isNaN(baddpay) || !interviewDateValue) {
                    resultDiv.innerHTML = '<p style="color: red;">全ての項目に数値を入力し、記入面談日を選択してください。</p>';
                    return;
                }

                // 詳細な数値バリデーション
                if (price < 50000 || price > 5000000 || frequency < 3 || frequency > 60 || dpay < 0 || baddpay < 0) {
                     resultDiv.innerHTML = '<p style="color: red;">入力された数値が条件を満たしていません。<br>商品金額: 5万円以上500万円以下, 支払回数: 3～60回, 頭金・ボーナス加算額: 0円以上</p>';
                     return;
                 }

                if (dpay > price) {
                     resultDiv.innerHTML = '<p style="color: red;">頭金は商品金額以下である必要があります。</p>';
                     return;
                 }

                 const interviewDay = parseInt(interviewDateValue.split('-')[2], 10);
                 if (isNaN(interviewDay) || interviewDay < 1 || interviewDay > 31) { // 簡易的な日付数値チェック
                     resultDiv.innerHTML = '<p style="color: red;">無効な記入面談日が入力されました。</p>';
                     return;
                 }


                const advance = price - dpay; // 分割支払金元本

                // frequency2perの引数はfrequency (1始まり)
                // payment計算ロジックは元のコードを維持
                const payment = advance + Math.floor(advance * (frequency2per(frequency) * 100) / 10000); // 分割支払金合計

                // 手数料 = 分割支払金合計 - 分割支払金元本
                const fee = payment - advance;

                const total = payment + dpay; // 支払総額 = 分割支払金合計 + 頭金

                const bcount = calcBCount(frequency, bmonth1, bmonth2, interviewDay); // ボーナス払い回数

                let first, rest;

                // 通常回支払額の計算 (元のコードを維持)
                let totalMonthlyPayPortion = payment - bcount * baddpay; // ボーナス加算額を除いた分割支払金合計
                if (totalMonthlyPayPortion < 0) totalMonthlyPayPortion = 0; // 念のためマイナスにならないように

                rest = frequency > 0 ? Math.floor(totalMonthlyPayPortion / frequency / 100) * 100 : 0; // 通常回支払額

                // 初回支払額の計算 (元のコードのロジックに倣い修正)
                 const firstPaymentMonth = calcFDate(interviewDay); // 初回支払月
                 const isFirstMonthBonus = (firstPaymentMonth === bmonth1 || firstPaymentMonth === bmonth2); // 初回支払月がボーナス月か判定

                 // 初回支払額は、分割支払金合計から、2回目以降の通常回支払いと、2回目以降のボーナス加算額を引いたもの
                 const normalPaymentsAfterFirst = (frequency > 1) ? rest * (frequency - 1) : 0;
                 const bonusPaymentsAfterFirst = (bcount - (isFirstMonthBonus ? 1 : 0)) * baddpay;

                 first = payment - normalPaymentsAfterFirst - bonusPaymentsAfterFirst;


                 // --- 結果表示 ---
                 let resultsHtml = '<h3>計算結果</h3>';
                 resultsHtml += `<p class="first-payment-date"></p>`; // 初回支払日表示用 (ここに後からJSで日付を入れる)

                 resultsHtml += `<p><strong>手数料額:</strong> ${fee.toLocaleString()} 円</p>`; // 手数料表示を追加

                 resultsHtml += `<p><strong>第1回目お支払い額:</strong> ${first.toLocaleString()} 円`;
                 if (isFirstMonthBonus && baddpay > 0) {
                     resultsHtml += ` (ボーナス月加算あり)`;
                 }
                 resultsHtml += `</p>`;

                 // 通常回数 = 総回数 - 1 (初回を除く)
                 let displayNormalCount = frequency - 1;
                 if (frequency === 1) displayNormalCount = 0; // 1回払いの場合は通常回数は0回


                 resultsHtml += `<p><strong>通常回(${Math.max(0, displayNormalCount)}回)のお支払い額:</strong> ${rest.toLocaleString()} 円</p>`;

                 // ボーナス加算額がある場合のみ、ボーナス回のお支払い額を表示
                 if (baddpay > 0) {
                     let bonusOnlyCount = bcount - (isFirstMonthBonus ? 1 : 0); // 初回を除くボーナス回数

                     if (bonusOnlyCount > 0) {
                         resultsHtml += `<p><strong>ボーナス回(${bonusOnlyCount}回)のお支払い額:</strong> ${(baddpay + rest).toLocaleString()} 円</p>`;
                          if (isFirstMonthBonus) {
                             resultsHtml += `<p class="note">※ 第1回目がボーナス月加算支払いを含む場合、第1回目支払額を参照してください。</p>`;
                         }
                     } else if (bcount === 1 && isFirstMonthBonus) {
                         // ボーナス回数が1回だけでそれが初回だった場合
                         resultsHtml += `<p class="note">※ ボーナス回(1回)は第1回目お支払い額に含まれます。</p>`;
                     }
                 }


                 resultsHtml += `<p><strong>お支払い総額(頭金を含む):</strong> ${total.toLocaleString()} 円</p>`;

                 // 分割支払金合計を単純に表示 (1589600判定を削除)
                 resultsHtml += `<p><strong>分割支払金合計(当社へのお支払い):</strong> ${payment.toLocaleString()} 円</p>`;


                 resultDiv.innerHTML = resultsHtml;

                 // 初回支払日を表示エリアに追加 (結果HTMLをセットした後に呼び出す)
                 displayFirstPaymentDate();

                 // 当社で選択可能な回数かどうかの注意書き
                if (frequencycheck(frequency) === false) {
                    const checkMsg = document.createElement('p');
                    checkMsg.style.color = 'orange'; /* 元画像に近い注意書きの色 */
                    checkMsg.classList.add('note'); /* 注意書きスタイル適用 */
                    checkMsg.innerText = `※ 注意: 支払回数「${frequency}回」は当社で選択出来る支払回数と異なる場合がございますので、計算結果は参考数値としてご利用下さい。`;
                    resultDiv.appendChild(checkMsg);
                }

                 // 通常回お支払い額が3千円以上かのチェック (計算ロジックではないが条件として考慮)
                 // ボーナス加算額がある場合でも、通常回支払額が3000円未満の場合は注意書きを表示
                 if (rest < 3000 && frequency > 1) { // 1回払いは除く
                     const checkMsg = document.createElement('p');
                     checkMsg.style.color = 'orange'; /* 元画像に近い注意書きの色 */
                     checkMsg.classList.add('note'); /* 注意書きスタイル適用 */
                     checkMsg.innerText = `※ 注意: 計算結果の通常回のお支払い額(${rest.toLocaleString()}円)は、当社の契約条件である3千円を下回っています。`;
                     resultDiv.appendChild(checkMsg);
                 }
            }


            function resetEMP() {
                const form = document.getElementById('KS_calcEMP');
                 // フォームの各入力フィールドをデフォルト値に戻す
                 form.price.value = 500000;
                 form.dpay.value = 0;
                 form.bmonth1.value = 0;
                 form.bmonth2.value = 0;
                 form.baddpay.value = 0;
                 form.frequency.value = 12; // デフォルト回数に戻す

                const today = new Date().toISOString().split('T')[0];
                 const interviewDateInput = form.querySelector('input[name="interviewDate"]');
                 if (interviewDateInput) {
                     interviewDateInput.value = today; // 日付フィールドを今日に戻す
                 }

                const resultDiv = document.getElementById('result-emp');
                if (resultDiv) {
                    resultDiv.innerHTML = ''; // 計算結果エリアをクリア
                }

                 // 初回支払日表示もクリア (結果エリアクリアでp要素ごと消えるため不要だが念のため)
                 const firstPaymentDateElement = form.querySelector('#result-emp .first-payment-date');
                 if (firstPaymentDateElement) {
                     firstPaymentDateElement.innerHTML = '';
                 }
            }

             window.onload = function() {
                 const today = new Date().toISOString().split('T')[0];
                 const interviewDateInputEMP = document.getElementById('interviewDateEMP');
                 const form = document.getElementById('KS_calcEMP');


                 // 記入面談日の初期値設定 (EMPフォームのみ)
                 if (interviewDateInputEMP) {
                     if (!interviewDateInputEMP.value) {
                        interviewDateInputEMP.value = today;
                     }
                     // 記入面談日の入力値が変更されたら初回支払日を更新
                     interviewDateInputEMP.addEventListener('change', (event) => {
                          // 結果エリアが表示されている場合のみ更新
                         if (document.getElementById('result-emp').innerHTML.trim() !== '') {
                            displayFirstPaymentDate();
                         }
                     });
                 }

                // 支払回数プルダウンの生成 (KS_calcEMP フォームのみ)
                 const frequencySelect = document.getElementById('frequency-select');
                 // frequencySelect が存在する場合のみ処理を実行
                 if (frequencySelect) {
                     const frequencies = [3, 6, 10, 12, 15, 18, 20, 24, 30, 36, 42, 48, 54, 60];
                     let optionsHtml = '';
                     frequencies.forEach(freq => {
                         optionsHtml += `<option value="${freq}">${freq}回</option>`;
                     });
                     frequencySelect.innerHTML = optionsHtml;
                     frequencySelect.value = 12; // デフォルト値として12回を選択
                 }

             };

        </script>

    </head>
    <body>
        <div class="container">
            <div class="main-section">
                <div class="entry-body">
                    <h1>お支払いシミュレーション</h1>
                    <p>
                        当社のクレジット契約におけるお支払い額やお支払い回数のシミュレーションを行うことが出来ます。以下のシミュレーションは実質年率を20%とした場合の計算になります。<br>当社のご契約条件は下記のようになっております。
                    </p>
                    <dl>
                        <dt>お申込者様ご年齢</dt>
                        <dd>申込時20歳以上完済時76歳未満</dd>
                        <dt>お申込可能商品金額</dt>
                        <dd>5万円以上500万円以下(消費税込)</dd>
                        <dt>お支払い回数</dt>
                        <dd>
                            3, 6, 10, 12, 15, 18, 20, 24, 30, 36, 42, 48, 54, 60回<br>※ ただし、通常回のお支払い額が3千円以上になる場合のみ。
                        </dd>
                        <dt>分割手数料率</dt>
                        <dd>原則 実質年率20%(商品により異なる場合がございます)</dd>
                        <dt>収納代行会社</dt>
                        <dd>SMBCファイナンスサービス株式会社</dd>
                    </dl>

                    <h2>商品金額とお支払回数から月々のお支払い額を計算する</h2>
                    <form id="KS_calcEMP" action="#" name="KS_calcEMP" class="calc-form">
                        <fieldset>
                            <legend>入力項目</legend>

                            <div class="form-item">
                                <label for="price_emp">商品金額</label>
                                <input id="price_emp" type="number" name="price" value="500000" min="50000" max="5000000">
                                <label for="price_emp" class="unit">円</label>
                            </div><br>

                            <div class="form-item">
                                <label for="dpay_emp">頭金</label>
                                <input id="dpay_emp" type="number" name="dpay" value="0" min="0">
                                <label for="dpay_emp" class="unit">円</label>
                            </div><br>

                            <div class="form-item">
                                <label for="bmonth1_emp">ボーナス月1</label>
                                <select id="bmonth1_emp" name="bmonth1">
                                    <option selected="selected" value="0">利用しない</option>
                                    <option value="6">6月</option>
                                    <option value="7">7月</option>
                                    <option value="8">8月</option>
                                </select>
                            </div><br>

                            <div class="form-item">
                                <label for="bmonth2_emp">ボーナス月2</label>
                                <select id="bmonth2_emp" name="bmonth2">
                                    <option selected="selected" value="0">利用しない</option>
                                    <option value="12">12月</option>
                                    <option value="1">1月</option>
                                </select>
                            </div><br>

                            <div class="form-item">
                                <label for="baddpay_emp">ボーナス月加算額</label>
                                <input id="baddpay_emp" type="number" name="baddpay" value="0" min="0">
                                <label for="baddpay_emp" class="unit">円</label>
                            </div><br>

                             <div class="form-item">
                                 <label for="interviewDateEMP">記入面談日</label>
                                 <input id="interviewDateEMP" type="date" name="interviewDate" value="">
                             </div><br>

                            <div class="form-item">
                                <label for="frequency-select">お支払回数</label>
                                <select id="frequency-select" name="frequency"></select>
                                <label for="frequency-select" class="unit">回</label>
                            </div><br>

                            <div class="button-group">
                                <input onclick="calcEMP()" type="button" value="計算">
                                <input onclick="resetEMP()" type="button" value="入力内容をクリア">
                            </div>

                            <ul>
                                <li>※ 当社で選択出来るお支払い回数以外の回数をご希望の場合は、お問合せください。</li>
                                 <li>※ ボーナス払いの場合、ご入力頂いた記入面談日を基準に計算しております。</li>
                                <li>※ 全ての項目に入力が必要です。頭金・ボーナス払いを利用しないときは0円とご入力下さい。</li>
                            </ul>
                        </fieldset>
                        <div id="result-emp" class="calculation-result">
                            <!-- 計算結果が表示されるエリア -->
                        </div>
                    </form>
                </div><!-- [ /.entry-body ] -->
            </div><!-- [ /.main-section ] -->
        </div><!-- [ /.container ] -->
    </body>
</html>
