<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>お支払いシミュレーション</title>
        <meta name='robots' content='max-image-preview:large'/>
        <meta name="description" content="お支払いシミュレーション"/>
        <!-- 元のテーマ・プラグインCSSの読み込みを削除 -->

        <!-- シミュレーター表示に必要な最低限の個別カスタマイズCSSを残す -->
        <style type="text/css">
            /* シミュレーターの結果表示エリアのスタイル */
            .calculation-result {
                margin-top: 20px;
                padding: 15px;
                border: 1px solid #ccc; /* シンプルな枠線 */
                border-radius: 5px; /* 角丸 */
                background-color: #f8f8f8; /* 薄い背景色 */
                font-size: 1rem;
                line-height: 1.6;
            }

            .calculation-result h3 {
                margin-top: 0;
                margin-bottom: 15px;
                border-bottom: 1px dashed #ccc;
                padding-bottom: 5px;
                font-size: 1.2rem;
            }

            .calculation-result p {
                margin-bottom: 10px;
            }
            .calculation-result p:last-child {
                margin-bottom: 0;
            }

            .calculation-result strong {
                display: inline-block; /* ラベルのように扱う */
                min-width: 150px; /* 項目名を揃える */
                margin-right: 10px;
            }

            .calculation-result .note {
                font-size: 0.9rem;
                color: #555;
                margin-top: 5px;
            }


            /* シミュレーターフォームのスタイル調整 */
            .calc-form {
                margin-bottom: 30px;
                padding: 20px;
                border: 1px solid #eee;
                border-radius: 5px;
                background-color: #fff;
            }

             .calc-form fieldset {
                 margin-bottom: 20px;
                 padding: 15px;
                 border: 1px solid #ddd;
                 border-radius: 4px;
            }
             .calc-form legend {
                 font-weight: bold;
                 margin-bottom: 10px;
                 padding: 0 5px;
                 border-bottom: none;
                 width: auto; /* フィールドセットの幅に合わせない */
            }

            .calc-form label {
                display: inline-block;
                margin-bottom: 5px;
                font-weight: bold;
                width: 180px; /* ラベル幅を固定して揃える */
                margin-right: 10px;
                vertical-align: middle;
            }
            .calc-form input[type="number"],
            .calc-form select {
                 width: 180px; /* input幅を調整 */
                 display: inline-block;
                 margin-bottom: 10px;
                 vertical-align: middle;
                 padding: 5px;
                 border: 1px solid #ccc;
                 border-radius: 4px;
            }
             .calc-form input[type="date"] {
                 width: 180px; /* input幅を調整 */
                 display: inline-block;
                 margin-bottom: 10px;
                 vertical-align: middle;
                 padding: 5px;
                 border: 1px solid #ccc;
                 border-radius: 4px;
             }

            .calc-form input[type="button"] {
                 margin-top: 10px;
                 margin-right: 10px;
                 padding: 8px 15px;
                 background-color: #007bff;
                 color: white;
                 border: none;
                 border-radius: 4px;
                 cursor: pointer;
                 font-size: 1rem;
            }
             .calc-form input[type="button"]:hover {
                 background-color: #0056b3;
             }

             .calc-form ul {
                 margin-top: 10px;
                 font-size: 0.9rem;
                 color: #555;
                 padding-left: 20px; /* リストのインデント */
             }
             .calc-form ul li {
                 margin-bottom: 5px;
                 list-style-type: disc; /* リストのスタイル */
             }

             h1, h2 {
                 color: #333;
                 margin-bottom: 20px;
                 border-bottom: 2px solid #007bff; /* 簡易的な下線 */
                 padding-bottom: 5px;
             }

             dl dt {
                 font-weight: bold;
                 margin-top: 10px;
             }
             dl dd {
                 margin-bottom: 10px;
                 margin-left: 20px;
             }

        </style>

        <!-- jQueryのみ残す -->
        <script type='text/javascript' src='https://www.kyoto-shinpan.co.jp/wp/wp-includes/js/jquery/jquery.min.js?ver=3.6.0'></script>

        <script type='text/javascript'>
            // frequency2per関数は元のコードから変更なし
            function frequency2per(frequency) {
                var p = new Array(1.67,2.51,3.35,4.2,5.06,5.91,6.78,7.64,8.52,9.39,10.28,11.16,12.05,12.95,13.85,14.75,15.66,16.57,17.49,18.41,19.34,20.27,21.21,22.15,23.1,24.04,25,25.96,26.92,27.89,28.86,29.84,30.82,31.8,32.79,33.79,34.79,35.79,36.8,37.81,38.83,39.85,40.87,41.9,42.94,43.98,45.02,46.07,47.12,48.17,49.23,50.3,51.37,52.44,53.52,54.6,55.68,56.77,57.87,58.96);
                //frequency は 1から60の想定
                if (frequency < 1 || frequency > p.length) {
                     console.warn(`Invalid frequency: ${frequency}. Returning 0.`);
                     return 0;
                }
                return p[frequency - 1];
            }

            // frequencycheck関数は元のコードから変更なし
            function frequencycheck(frequency) {
                var p = new Array(3,6,10,12,15,18,20,24,30,36,42,48,54,60);
                return p.includes(frequency);
            }

             // calcFDate関数は元のコードから変更なし
            function calcFDate(interviewDay) {
                const today = new Date();
                const currentMonth = today.getMonth() + 1; // 1-12

                if (interviewDay <= 14) {
                    return currentMonth;
                } else {
                    let nextMonth = currentMonth + 1;
                    if (nextMonth > 12) {
                         nextMonth = nextMonth - 12;
                    }
                    return nextMonth;
                }
            }

            // displayFirstPaymentDate関数は元のコードから変更なし (EMPフォーム専用に調整)
            function displayFirstPaymentDate() {
                const form = document.getElementById('KS_calcEMP');
                const interviewDateInput = form.querySelector('input[name="interviewDate"]');
                const firstPaymentDateElement = form.querySelector('.first-payment-date'); // 結果エリア内の要素を探す

                if (!interviewDateInput || !firstPaymentDateElement) {
                    // 要素が見つからない場合は処理しない
                    return;
                }

                const interviewDateValue = interviewDateInput.value;
                // 結果エリアに日付が入力されていない旨を表示
                if (!interviewDateValue) {
                    // 結果エリアが空の場合は表示しない
                    if (document.getElementById('result-emp').innerHTML.trim() !== '') {
                         // 結果が表示されているのに日付がない場合のみエラー表示
                         firstPaymentDateElement.innerHTML = "<strong>初回支払日:</strong> 記入面談日を選択してください。";
                    }
                    return;
                }

                const dateParts = interviewDateValue.split('-');
                if (dateParts.length !== 3) {
                    firstPaymentDateElement.innerHTML = "<strong>初回支払日:</strong> 無効な日付形式です。";
                    return;
                }

                const year = parseInt(dateParts[0], 10);
                const month = parseInt(dateParts[1], 10);
                const day = parseInt(dateParts[2], 10);

                 if (isNaN(year) || isNaN(month) || isNaN(day)) {
                     firstPaymentDateElement.innerHTML = "<strong>初回支払日:</strong> 無効な日付が入力されました。";
                    return;
                 }


                 let firstPaymentMonthCalc = month; // 1-12
                 let firstPaymentYearCalc = year;

                 if (day >= 15) {
                     firstPaymentMonthCalc += 1;
                     if (firstPaymentMonthCalc > 12) {
                         firstPaymentMonthCalc = 1;
                         firstPaymentYearCalc += 1;
                     }
                 }

                const firstPaymentDay = 27; // 支払日は固定で27日と仮定
                firstPaymentDateElement.innerHTML = `<strong>初回支払日:</strong> ${firstPaymentYearCalc}年${firstPaymentMonthCalc}月${firstPaymentDay}日`;
            }


            // calcBCount関数は元のコードから変更なし (EMPフォーム専用に調整)
            function calcBCount(frequency, bmonth1, bmonth2, interviewDay) {
                let count = 0;
                const firstPaymentMonth = calcFDate(interviewDay); // 1-12

                // frequency2perのテーブルは60回まで対応しているため、frequencyの上限を60回とする
                const effectiveFrequency = Math.min(frequency, 60);

                for (let i = 0; i < effectiveFrequency; i++) {
                    let currentMonth = firstPaymentMonth + i;
                    while (currentMonth > 12) {
                        currentMonth -= 12;
                    }

                    if (currentMonth === bmonth1 || currentMonth === bmonth2) {
                        count++;
                    }
                }
                return count;
            }


            function calcEMP() {
                const form = document.getElementById('KS_calcEMP');
                const resultDiv = document.getElementById('result-emp');
                resultDiv.innerHTML = ''; // 計算前に結果表示エリアをクリア

                const price = parseInt(form.price.value);
                // プルダウンから値を取得
                const frequency = parseInt(form.frequency.value);
                const dpay = parseInt(form.dpay.value);
                const bmonth1 = parseInt(form.bmonth1.value);
                const bmonth2 = parseInt(form.bmonth2.value);
                const baddpay = parseInt(form.baddpay.value);
                const interviewDateInput = form.querySelector('input[name="interviewDate"]');
                const interviewDateValue = interviewDateInput ? interviewDateInput.value : '';

                // バリデーション
                if (isNaN(price) || isNaN(frequency) || isNaN(dpay) || isNaN(bmonth1) || isNaN(bmonth2) || isNaN(baddpay) || !interviewDateValue) {
                    resultDiv.innerHTML = '<p style="color: red;">全ての項目に数値を入力し、記入面談日を選択してください。</p>';
                    // 日付選択がない場合は初回支払日表示もリセットまたはエラー表示
                    displayFirstPaymentDate(); // エラーメッセージが表示される
                    return;
                }

                // 商品金額の上限を500万円に修正
                if (price < 50000 || price > 5000000 || frequency < 3 || frequency > 60 || dpay < 0 || baddpay < 0) {
                     resultDiv.innerHTML = '<p style="color: red;">入力された数値が条件を満たしていません。<br>商品金額: 5万円以上500万円以下, 支払回数: 3～60回, 頭金・ボーナス加算額: 0円以上</p>';
                      // 日付選択がある場合でも、入力値エラーなら初回支払日表示はリセット
                     document.getElementById('result-emp').querySelector('.first-payment-date').innerHTML = '';
                     return;
                 }

                if (dpay > price) {
                     resultDiv.innerHTML = '<p style="color: red;">頭金は商品金額以下である必要があります。</p>';
                      // 日付選択がある場合でも、入力値エラーなら初回支払日表示はリセット
                     document.getElementById('result-emp').querySelector('.first-payment-date').innerHTML = '';
                     return;
                 }

                 const interviewDay = parseInt(interviewDateValue.split('-')[2], 10);
                 if (isNaN(interviewDay)) {
                      resultDiv.innerHTML = '<p style="color: red;">無効な記入面談日が入力されました。</p>';
                       // 日付選択がある場合でも、入力値エラーなら初回支払日表示はリセット
                     document.getElementById('result-emp').querySelector('.first-payment-date').innerHTML = '';
                     return;
                 }


                const advance = price - dpay;

                // frequency2perの引数はfrequency (1始まり)
                const payment = advance + Math.floor(advance * (frequency2per(frequency) * 100) / 10000);

                // 手数料は payment - advance で計算し表示に追加
                const fee = payment - advance;

                const total = payment + dpay;

                const bcount = calcBCount(frequency, bmonth1, bmonth2, interviewDay);

                let first, rest;

                // 通常回支払額の計算
                let totalMonthlyPay = payment - bcount * baddpay;
                if (totalMonthlyPay < 0) totalMonthlyPay = 0; // 念のためマイナスにならないように

                rest = frequency > 0 ? Math.floor(totalMonthlyPay / frequency / 100) * 100 : 0;

                // 初回支払額の計算 (元コードのロジックに合わせる)
                 const firstPaymentMonth = calcFDate(interviewDay);
                 const isFirstMonthBonus = (firstPaymentMonth === bmonth1 || firstPaymentMonth === bmonth2);

                 // 初回支払額 = 分割支払金合計 - 通常回支払額 * (総回数 - 1) - ボーナス月加算額 * (ボーナス回数 - 初回がボーナス月か？)
                 // frequencyが1の場合は通常回支払いはない
                 const normalPayExceptFirst = (frequency > 1) ? rest * (frequency - 1) : 0;

                 // 初回支払額 = 分割支払金合計 - (2回目以降の通常回支払い合計) - (2回目以降のボーナス加算支払い合計)
                 const remainingBonusCount = bcount - (isFirstMonthBonus ? 1 : 0);
                 const bonusPayExceptFirst = remainingBonusCount * baddpay;

                 first = payment - normalPayExceptFirst - bonusPayExceptFirst;


                 // --- 結果表示 ---
                 let resultsHtml = '<h3>計算結果</h3>';
                 resultsHtml += `<p class="first-payment-date"></p>`; // 初回支払日表示用

                 resultsHtml += `<p><strong>手数料額:</strong> ${fee.toLocaleString()} 円</p>`; // 手数料表示を追加

                 resultsHtml += `<p><strong>第1回目お支払い額:</strong> ${first.toLocaleString()} 円`;
                 if (isFirstMonthBonus && baddpay > 0) {
                     resultsHtml += ` (ボーナス月)`;
                 }
                 resultsHtml += `</p>`;

                 // 通常回数 = 総回数 - 1 (初回を除く)
                 let displayNormalCount = frequency - 1;
                 if (frequency === 1) displayNormalCount = 0; // 1回払いの場合は通常回数は0回


                 resultsHtml += `<p><strong>通常回(${Math.max(0, displayNormalCount)}回)のお支払い額:</strong> ${rest.toLocaleString()} 円</p>`;

                 if (bcount > 0 && baddpay > 0) {
                    // ボーナス加算額が0より大きい場合のみ表示
                     let bonusDisplayCount = bcount;
                     // 初回がボーナス加算支払いを含む場合、ボーナス回数から1を引いて表示（初回を除く回数）
                     if (isFirstMonthBonus) {
                          bonusDisplayCount = bcount - 1;
                     }
                     if (bonusDisplayCount > 0) {
                         resultsHtml += `<p><strong>ボーナス回(${bonusDisplayCount}回)のお支払い額:</strong> ${(baddpay + rest).toLocaleString()} 円</p>`;
                         if (isFirstMonthBonus) {
                             resultsHtml += `<p class="note">※ 第1回目がボーナス月の場合、第1回目支払額を参照してください。</p>`;
                         }
                     } else if (bcount === 1 && isFirstMonthBonus) {
                        // ボーナス回数が1回だけでそれが初回だった場合
                         resultsHtml += `<p class="note">※ ボーナス回(1回)は第1回目お支払い額に含まれます。</p>`;
                     }
                 }


                 resultsHtml += `<p><strong>お支払い総額(頭金を含む):</strong> ${total.toLocaleString()} 円</p>`;

                 // 1589600の判定を削除し、単純に表示
                 resultsHtml += `<p><strong>分割支払金合計(当社へのお支払い):</strong> ${payment.toLocaleString()} 円</p>`;


                 resultDiv.innerHTML = resultsHtml;

                 // 初回支払日を表示エリアに追加
                 displayFirstPaymentDate();

                if (frequencycheck(frequency) === false) {
                    const checkMsg = document.createElement('p');
                    checkMsg.style.color = 'orange';
                    checkMsg.innerText = `※ 注意: 支払回数「${frequency}回」は当社で選択出来る支払回数と異なりますので、計算結果は参考数値としてご利用下さい。`;
                    resultDiv.appendChild(checkMsg);
                }

                 // 通常回お支払い額が3千円以上かのチェック (計算ロジックではないが条件として考慮)
                 // ボーナス加算額がある場合でも、通常回支払額が3000円未満の場合は注意書きを表示
                 if (rest < 3000) {
                     const checkMsg = document.createElement('p');
                     checkMsg.style.color = 'orange';
                     checkMsg.innerText = `※ 注意: 計算結果の通常回のお支払い額(${rest.toLocaleString()}円)は、当社の契約条件である3千円を下回っています。`;
                     resultDiv.appendChild(checkMsg);
                 }
            }


            function resetEMP() {
                const form = document.getElementById('KS_calcEMP');
                 // フォームのリセット
                 form.reset();

                const resultDiv = document.getElementById('result-emp');
                if (resultDiv) {
                    resultDiv.innerHTML = ''; // 計算結果エリアをクリア
                }

                // 日付フィールドを今日に戻す
                 const today = new Date().toISOString().split('T')[0];
                 const interviewDateInput = form.querySelector('input[name="interviewDate"]');
                 if (interviewDateInput) {
                     interviewDateInput.value = today;
                 }

                 // 初回支払日表示もクリア
                 const firstPaymentDateElement = form.querySelector('.first-payment-date'); // 結果エリア内の要素を探す
                 if (firstPaymentDateElement) {
                     firstPaymentDateElement.innerHTML = '';
                 }
            }

             window.onload = function() {
                 const today = new Date().toISOString().split('T')[0];
                 const interviewDateInputEMP = document.getElementById('interviewDateEMP');

                 // 記入面談日の初期値設定 (EMPフォームのみ)
                 if (interviewDateInputEMP) {
                     if (!interviewDateInputEMP.value) {
                        interviewDateInputEMP.value = today;
                     }
                 }

                // 支払回数プルダウンの生成 (KS_calcEMP フォームのみ)
                 const frequencySelect = document.getElementById('frequency-select');
                 // frequencySelect が存在する場合のみ処理を実行
                 if (frequencySelect) {
                     const frequencies = [3, 6, 10, 12, 15, 18, 20, 24, 30, 36, 42, 48, 54, 60];
                     let optionsHtml = '';
                     frequencies.forEach(freq => {
                         optionsHtml += `<option value="${freq}">${freq}回</option>`;
                     });
                     frequencySelect.innerHTML = optionsHtml;
                     frequencySelect.value = 12; // デフォルト値として12回を選択
                 }

                 // 記入面談日の入力値が変更されたら初回支払日を更新 (EMPフォームのみ)
                  if (interviewDateInputEMP) {
                         interviewDateInputEMP.addEventListener('change', (event) => {
                              // 結果エリアが表示されている場合のみ更新
                             if (document.getElementById('result-emp').innerHTML.trim() !== '') {
                                displayFirstPaymentDate();
                             }
                         });
                  }
             };

        </script>

        <!-- custom-background-css も削除 -->

    </head>
    <body>
        <div class="site-body">
            <div class="site-body-container container">
                <div class="main-section" id="main" role="main">
                    <div id="post-2848" class="entry entry-full post-2848 page type-page status-publish hentry">
                        <div class="entry-body">
                            <h1>お支払いシミュレーション</h1>
                            <p>
                                当社のクレジット契約におけるお支払い額やお支払い回数のシミュレーションを行うことが出来ます。以下のシミュレーションは実質年率を20%とした場合の計算になります。<br>当社のご契約条件は下記のようになっております。

                            </p>
                            <dl>
                                <dt>お申込者様ご年齢</dt>
                                <dd>申込時20歳以上完済時76歳未満</dd>
                                <dt>お申込可能商品金額</dt>
                                <dd>5万円以上500万円以下(消費税込)</dd>
                                <dt>お支払い回数</dt>
                                <dd>
                                    3, 6, 10, 12, 15, 18, 20, 24, 30, 36, 42, 48, 54, 60回<br>※ ただし、通常回のお支払い額が3千円以上になる場合のみ。
                                </dd>
                                <dt>分割手数料率</dt>
                                <dd>原則 実質年率20%(商品により異なる場合がございます)</dd>
                                <dt>収納代行会社</dt>
                                <dd>SMBCファイナンスサービス株式会社</dd>
                            </dl>
                            <h2>商品金額とお支払回数から月々のお支払い額を計算する</h2>
                            <form id="KS_calcEMP" action="#" name="KS_calcEMP" class="calc-form">
                                <fieldset>
                                    <legend>入力項目</legend>
                                    <label for="price_emp">商品金額</label>
                                    <input id="price_emp" type="number" name="price" value="500000" min="50000" max="5000000">
                                    <label for="price_emp">円</label>
                                    <br>
                                    <label for="dpay_emp">頭金</label>
                                    <input id="dpay_emp" type="number" name="dpay" value="0" min="0">
                                    <label for="dpay_emp">円</label>
                                    <br>
                                    <label for="bmonth1_emp">ボーナス月1</label>
                                    <select id="bmonth1_emp" name="bmonth1">
                                        <option selected="selected" value="0">利用しない</option>
                                        <option value="6">6月</option>
                                        <option value="7">7月</option>
                                        <option value="8">8月</option>
                                    </select>
                                    <br>
                                    <label for="bmonth2_emp">ボーナス月2</label>
                                    <select id="bmonth2_emp" name="bmonth2">
                                        <option selected="selected" value="0">利用しない</option>
                                        <option value="12">12月</option>
                                        <option value="1">1月</option>
                                    </select>
                                    <br>
                                    <label for="baddpay_emp">ボーナス月加算額</label>
                                    <input id="baddpay_emp" type="number" name="baddpay" value="0" min="0">
                                    <label for="baddpay_emp">円</label>
                                    <br>
                                     <label for="interviewDateEMP">記入面談日</label>
                                     <input id="interviewDateEMP" type="date" name="interviewDate" value="">
                                     <br>
                                    <label for="frequency-select">お支払回数</label>
                                    <select id="frequency-select" name="frequency"></select>
                                    <label for="frequency-select">回</label>
                                    <br>
                                    <input onclick="calcEMP()" type="button" value="計算" class="button-primary">
                                    <input onclick="resetEMP()" type="button" value="入力内容をクリア" class="button-primary">
                                    <ul>
                                        <li>※ 当社で選択出来るお支払い回数以外の回数をご希望の場合は、お問合せください。</li>
                                         <li>※ ボーナス払いの場合、ご入力頂いた記入面談日を基準に計算しております。</li>
                                        <li>※ 全ての項目に入力が必要です。頭金・ボーナス払いを利用しないときは0円とご入力下さい。</li>
                                    </ul>
                                </fieldset>
                                <div id="result-emp" class="calculation-result">
                                    <!-- 計算結果が表示されるエリア -->
                                </div>
                            </form>
                            <!-- 商品金額と月々のご希望お支払い額からお支払い回数を計算するフォームを削除 -->
                        </div>
                    </div>
                    <!-- [ /#post-2848 ] -->
                </div>
                <!-- [ /.main-section ] -->
            </div>
            <!-- [ /.site-body-container ] -->
        </div>
        <!-- [ /.site-body ] -->
        <!-- フッターやナビゲーション関連は削除 -->
    </body>
</html>
